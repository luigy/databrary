<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Asset</span><span>
</span><a name="line-3"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Databrary.Controller.Asset.html#getAsset"><span class="hs-identifier hs-var">getAsset</span></a><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#assetJSONField"><span class="hs-identifier hs-var">assetJSONField</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#viewAsset"><span class="hs-identifier hs-var">viewAsset</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#AssetTarget"><span class="hs-identifier hs-type">AssetTarget</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#postAsset"><span class="hs-identifier hs-var">postAsset</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#viewAssetEdit"><span class="hs-identifier hs-var">viewAssetEdit</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#createAsset"><span class="hs-identifier hs-var">createAsset</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#viewAssetCreate"><span class="hs-identifier hs-var">viewAssetCreate</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#createSlotAsset"><span class="hs-identifier hs-var">createSlotAsset</span></a><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#viewSlotAssetCreate"><span class="hs-identifier hs-var">viewSlotAssetCreate</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#deleteAsset"><span class="hs-identifier hs-var">deleteAsset</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#downloadAsset"><span class="hs-identifier hs-var">downloadAsset</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#thumbAsset"><span class="hs-identifier hs-var">thumbAsset</span></a><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Asset.html#assetDownloadName"><span class="hs-identifier hs-var">assetDownloadName</span></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;|&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=&lt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">void</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">guard</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">when</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Trans</span><span class="hs-operator">.</span><span class="hs-identifier">Class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isJust</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">maybeToList</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Encoding</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TE</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Database</span><span class="hs-operator">.</span><span class="hs-identifier">PostgreSQL</span><span class="hs-operator">.</span><span class="hs-identifier">Typed</span><span class="hs-operator">.</span><span class="hs-identifier">Range</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Range</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">conflict409</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">Wai</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Wai</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">Wai</span><span class="hs-operator">.</span><span class="hs-identifier">Parse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FileInfo</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Ops.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Ops</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Has.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Has</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Databrary.JSON.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">JSON</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">JSON</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Segment.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Segment</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Permission.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Permission</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Release.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Release</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Id.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Id</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Volume.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Volume</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Container.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Container</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Token.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Token</span></a><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Format.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Asset.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Asset</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Slot.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Slot</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.AssetSlot.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">AssetSlot</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.AssetSegment.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">AssetSegment</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Excerpt.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Excerpt</span></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.AssetRevision.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">AssetRevision</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Transcode.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Transcode</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Notification.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Notification</span></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Files.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Files</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Databrary.Files.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.Types.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.Asset.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">Asset</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.Upload.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">Upload</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.Temp.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">Temp</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.Transcode.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">Transcode</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.AV.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">AV</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Store.AV.html#avProbeLength"><span class="hs-identifier hs-var">avProbeLength</span></a><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.Probe.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">Probe</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.HTTP.Request.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Request</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.HTTP.Form.Errors.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Form</span><span class="hs-operator">.</span><span class="hs-identifier">Errors</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.HTTP.Form.Deform.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Form</span><span class="hs-operator">.</span><span class="hs-identifier">Deform</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.HTTP.Path.Parser.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Path</span><span class="hs-operator">.</span><span class="hs-identifier">Parser</span></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Action.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Action</span></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Controller.Paths.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Paths</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Controller.Permission.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Permission</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Controller.Form.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Form</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Controller.Volume.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Volume</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Controller.Slot.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Slot</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Controller.Format.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Format</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Controller.Notification.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Notification</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE #-}</span><span> </span><a href="Databrary.Controller.AssetSegment.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">AssetSegment</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.View.Asset.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">View</span><span class="hs-operator">.</span><span class="hs-identifier">Asset</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-identifier">getAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Model.Permission.Types.html#Permission"><span class="hs-identifier hs-type">Permission</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Asset.Types.html#Asset"><span class="hs-identifier hs-type">Asset</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Types.html#ActionM"><span class="hs-identifier hs-type">ActionM</span></a><span> </span><a href="Databrary.Model.AssetSlot.Types.html#AssetSlot"><span class="hs-identifier hs-type">AssetSlot</span></a><span>
</span><a name="line-75"></a><a name="getAsset"><a href="Databrary.Controller.Asset.html#getAsset"><span class="hs-identifier">getAsset</span></a></a><span> </span><a name="local-1630121318"><a href="#local-1630121318"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-1630121319"><a href="#local-1630121319"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-76"></a><span>  </span><a href="Databrary.Controller.Permission.html#checkPermission"><span class="hs-identifier hs-var">checkPermission</span></a><span> </span><a href="#local-1630121318"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.Action.html#maybeAction"><span class="hs-identifier hs-var">maybeAction</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.Model.AssetSlot.html#lookupAssetSlot"><span class="hs-identifier hs-var">lookupAssetSlot</span></a><span> </span><a href="#local-1630121319"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-identifier">assetJSONField</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#AssetSlot"><span class="hs-identifier hs-type">AssetSlot</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">BS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Types.html#ActionM"><span class="hs-identifier hs-type">ActionM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Encoding</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><a name="assetJSONField"><a href="Databrary.Controller.Asset.html#assetJSONField"><span class="hs-identifier">assetJSONField</span></a></a><span> </span><a name="local-1630121320"><a href="#local-1630121320"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-string">&quot;container&quot;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.JSON.html#recordEncoding"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">recordEncoding</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Model.Container.html#containerJSON"><span class="hs-identifier hs-var">containerJSON</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Model.Slot.Types.html#slotContainer"><span class="hs-identifier hs-var">slotContainer</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#assetSlot"><span class="hs-identifier hs-var">assetSlot</span></a><span> </span><a href="#local-1630121320"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-81"></a><span class="hs-identifier">assetJSONField</span><span> </span><a name="local-1630121321"><a href="#local-1630121321"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-string">&quot;creation&quot;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><a href="#local-1630121321"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionEDIT"><span class="hs-identifier hs-var">PermissionEDIT</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-82"></a><span>  </span><span class="hs-special">(</span><a name="local-1630121322"><a href="#local-1630121322"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121323"><a href="#local-1630121323"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.Asset.html#assetCreation"><span class="hs-identifier hs-var">assetCreation</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121321"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-83"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.JSON.html#objectEncoding"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">objectEncoding</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-84"></a><span>       </span><span class="hs-string">&quot;date&quot;</span><span> </span><a href="Databrary.JSON.html#.%3D%3F"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">..=?</span></a><span> </span><a href="#local-1630121322"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;name&quot;</span><span> </span><a href="Databrary.JSON.html#.%3D%3F"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">..=?</span></a><span> </span><a href="#local-1630121323"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-86"></a><span class="hs-identifier">assetJSONField</span><span> </span><a name="local-1630121324"><a href="#local-1630121324"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-string">&quot;excerpts&quot;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.JSON.html#mapObjects"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">mapObjects</span></a><span> </span><a href="Databrary.Model.Excerpt.html#excerptJSON"><span class="hs-identifier hs-var">excerptJSON</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.Model.Excerpt.html#lookupAssetExcerpts"><span class="hs-identifier hs-var">lookupAssetExcerpts</span></a><span> </span><a href="#local-1630121324"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-88"></a><span class="hs-identifier">assetJSONField</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-identifier">assetJSONQuery</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#AssetSlot"><span class="hs-identifier hs-type">AssetSlot</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Query</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Types.html#ActionM"><span class="hs-identifier hs-type">ActionM</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.JSON.html#Record"><span class="hs-identifier hs-type">JSON</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Record</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Asset.Types.html#Asset"><span class="hs-identifier hs-type">Asset</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Series</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><a name="assetJSONQuery"><a href="Databrary.Controller.Asset.html#assetJSONQuery"><span class="hs-identifier">assetJSONQuery</span></a></a><span> </span><a name="local-1630121325"><a href="#local-1630121325"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-1630121326"><a href="#local-1630121326"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.AssetSlot.html#assetSlotJSON"><span class="hs-identifier hs-var">assetSlotJSON</span></a><span> </span><a href="#local-1630121325"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="Databrary.JSON.html#.%3C%3E"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">..&lt;&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.JSON.html#jsonQuery"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">jsonQuery</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#assetJSONField"><span class="hs-identifier hs-var">assetJSONField</span></a><span> </span><a href="#local-1630121325"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span> </span><a href="#local-1630121326"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-identifier">assetDownloadName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Model.Asset.Types.html#AssetRow"><span class="hs-identifier hs-type">AssetRow</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">T</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">]</span><span>
</span><a name="line-94"></a><a name="assetDownloadName"><a href="Databrary.Controller.Asset.html#assetDownloadName"><span class="hs-identifier">assetDownloadName</span></a></a><span> </span><a name="local-1630121327"><a href="#local-1630121327"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">T</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">pack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetId"><span class="hs-identifier hs-var">assetId</span></a><span> </span><a href="#local-1630121327"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">maybeToList</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetName"><span class="hs-identifier hs-var">assetName</span></a><span> </span><a href="#local-1630121327"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-identifier">viewAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#API"><span class="hs-identifier hs-type">API</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Asset.Types.html#Asset"><span class="hs-identifier hs-type">Asset</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><a name="viewAsset"><a href="Databrary.Controller.Asset.html#viewAsset"><span class="hs-identifier">viewAsset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">GET</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathAPI"><span class="hs-identifier hs-var">pathAPI</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1630121328"><a href="#local-1630121328"><span class="hs-identifier">api</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121329"><a href="#local-1630121329"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-98"></a><span>  </span><a name="local-1630121330"><a href="#local-1630121330"><span class="hs-identifier">asset</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Asset.html#getAsset"><span class="hs-identifier hs-var">getAsset</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionPUBLIC"><span class="hs-identifier hs-var">PermissionPUBLIC</span></a><span> </span><a href="#local-1630121329"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-99"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-1630121328"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-100"></a><span>    </span><a href="Databrary.Action.Route.html#JSON"><span class="hs-identifier hs-var">JSON</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Response.html#okResponse"><span class="hs-identifier hs-var">okResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#assetJSONQuery"><span class="hs-identifier hs-var">assetJSONQuery</span></a><span> </span><a href="#local-1630121330"><span class="hs-identifier hs-var">asset</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-identifier hs-var">Wai</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">queryString</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>    </span><a href="Databrary.Action.Route.html#HTML"><span class="hs-identifier hs-var">HTML</span></a><span>
</span><a name="line-102"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1630121331"><a href="#local-1630121331"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#assetSlot"><span class="hs-identifier hs-var">assetSlot</span></a><span> </span><a href="#local-1630121330"><span class="hs-identifier hs-var">asset</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.html#otherRouteResponse"><span class="hs-identifier hs-var">otherRouteResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="Databrary.Controller.AssetSegment.html#viewAssetSegment"><span class="hs-identifier hs-var">viewAssetSegment</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630121328"><span class="hs-identifier hs-var">api</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><a href="#local-1630121330"><span class="hs-identifier hs-var">asset</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Slot.Types.html#slotId"><span class="hs-identifier hs-var">slotId</span></a><span> </span><a href="#local-1630121331"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetId"><span class="hs-identifier hs-var">assetId</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121330"><span class="hs-identifier hs-var">asset</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Response.html#okResponse"><span class="hs-identifier hs-var">okResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">T</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetId"><span class="hs-identifier hs-var">assetId</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121330"><span class="hs-identifier hs-var">asset</span></a><span> </span><span class="hs-comment">-- TODO</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-keyword">data</span><span> </span><a name="AssetTarget"><a href="Databrary.Controller.Asset.html#AssetTarget"><span class="hs-identifier">AssetTarget</span></a></a><span>
</span><a name="line-106"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="AssetTargetVolume"><a href="Databrary.Controller.Asset.html#AssetTargetVolume"><span class="hs-identifier">AssetTargetVolume</span></a></a><span> </span><a href="Databrary.Model.Volume.Types.html#Volume"><span class="hs-identifier hs-type">Volume</span></a><span>
</span><a name="line-107"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AssetTargetSlot"><a href="Databrary.Controller.Asset.html#AssetTargetSlot"><span class="hs-identifier">AssetTargetSlot</span></a></a><span> </span><a href="Databrary.Model.Slot.Types.html#Slot"><span class="hs-identifier hs-type">Slot</span></a><span>
</span><a name="line-108"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AssetTargetAsset"><a href="Databrary.Controller.Asset.html#AssetTargetAsset"><span class="hs-identifier">AssetTargetAsset</span></a></a><span> </span><a href="Databrary.Model.AssetSlot.Types.html#AssetSlot"><span class="hs-identifier hs-type">AssetSlot</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-keyword">data</span><span> </span><a name="FileUploadFile"><a href="Databrary.Controller.Asset.html#FileUploadFile"><span class="hs-identifier">FileUploadFile</span></a></a><span>
</span><a name="line-111"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="FileUploadForm"><a href="Databrary.Controller.Asset.html#FileUploadForm"><span class="hs-identifier">FileUploadForm</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FileInfo</span><span> </span><a href="Databrary.Store.Temp.html#TempFile"><span class="hs-identifier hs-type">TempFile</span></a><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FileUploadToken"><a href="Databrary.Controller.Asset.html#FileUploadToken"><span class="hs-identifier">FileUploadToken</span></a></a><span> </span><a href="Databrary.Model.Token.Types.html#Upload"><span class="hs-identifier hs-type">Upload</span></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-identifier">fileUploadName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Controller.Asset.html#FileUploadFile"><span class="hs-identifier hs-type">FileUploadFile</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-115"></a><a name="fileUploadName"><a href="Databrary.Controller.Asset.html#fileUploadName"><span class="hs-identifier">fileUploadName</span></a></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#FileUploadForm"><span class="hs-identifier hs-var">FileUploadForm</span></a><span> </span><a name="local-1630121332"><a href="#local-1630121332"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fileName</span><span> </span><a href="#local-1630121332"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-116"></a><span class="hs-identifier">fileUploadName</span><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#FileUploadToken"><span class="hs-identifier hs-var">FileUploadToken</span></a><span> </span><a name="local-1630121333"><a href="#local-1630121333"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.Token.Types.html#uploadFilename"><span class="hs-identifier hs-var">uploadFilename</span></a><span> </span><a href="#local-1630121333"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-identifier">fileUploadPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Controller.Asset.html#FileUploadFile"><span class="hs-identifier hs-type">FileUploadFile</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Store.Types.html#Storage"><span class="hs-identifier hs-type">Storage</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RawFilePath</span><span>
</span><a name="line-119"></a><a name="fileUploadPath"><a href="Databrary.Controller.Asset.html#fileUploadPath"><span class="hs-identifier">fileUploadPath</span></a></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#FileUploadForm"><span class="hs-identifier hs-var">FileUploadForm</span></a><span> </span><a name="local-1630121334"><a href="#local-1630121334"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Store.Temp.html#tempFilePath"><span class="hs-identifier hs-var">tempFilePath</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fileContent</span><span> </span><a href="#local-1630121334"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-120"></a><span class="hs-identifier">fileUploadPath</span><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#FileUploadToken"><span class="hs-identifier hs-var">FileUploadToken</span></a><span> </span><a name="local-1630121335"><a href="#local-1630121335"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1630121336"><a href="#local-1630121336"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Store.Upload.html#uploadFile"><span class="hs-identifier hs-var">uploadFile</span></a><span> </span><a href="#local-1630121335"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-1630121336"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-identifier">fileUploadRemove</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Controller.Asset.html#FileUploadFile"><span class="hs-identifier hs-type">FileUploadFile</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Types.html#ActionM"><span class="hs-identifier hs-type">ActionM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-123"></a><a name="fileUploadRemove"><a href="Databrary.Controller.Asset.html#fileUploadRemove"><span class="hs-identifier">fileUploadRemove</span></a></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#FileUploadForm"><span class="hs-identifier hs-var">FileUploadForm</span></a><span> </span><a name="local-1630121337"><a href="#local-1630121337"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Has.html#focusIO"><span class="hs-identifier hs-var">focusIO</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Store.Temp.html#releaseTempFile"><span class="hs-identifier hs-var">releaseTempFile</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fileContent</span><span> </span><a href="#local-1630121337"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-124"></a><span class="hs-identifier">fileUploadRemove</span><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#FileUploadToken"><span class="hs-identifier hs-var">FileUploadToken</span></a><span> </span><a name="local-1630121338"><a href="#local-1630121338"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Token.html#removeUpload"><span class="hs-identifier hs-var">removeUpload</span></a><span> </span><a href="#local-1630121338"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-keyword">data</span><span> </span><a name="FileUpload"><a href="Databrary.Controller.Asset.html#FileUpload"><span class="hs-identifier">FileUpload</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FileUpload"><a href="Databrary.Controller.Asset.html#FileUpload"><span class="hs-identifier">FileUpload</span></a></a><span>
</span><a name="line-127"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="fileUploadFile"><a href="Databrary.Controller.Asset.html#fileUploadFile"><span class="hs-identifier">fileUploadFile</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Controller.Asset.html#FileUploadFile"><span class="hs-identifier hs-type">FileUploadFile</span></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="fileUploadProbe"><a href="Databrary.Controller.Asset.html#fileUploadProbe"><span class="hs-identifier">fileUploadProbe</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Store.Probe.html#Probe"><span class="hs-identifier hs-type">Probe</span></a><span>
</span><a name="line-129"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-identifier">deformLookup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-1630121315"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-1630121315"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#Deform"><span class="hs-identifier hs-type">Deform</span></a><span> </span><a href="#local-1630121317"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-1630121314"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Databrary.HTTP.Form.Errors.html#FormErrorMessage"><span class="hs-identifier hs-type">FormErrorMessage</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1630121314"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1630121315"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1630121316"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#DeformT"><span class="hs-identifier hs-type">DeformT</span></a><span> </span><a href="#local-1630121317"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-1630121315"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-1630121316"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><a name="deformLookup"><a href="Databrary.Controller.Asset.html#deformLookup"><span class="hs-identifier">deformLookup</span></a></a><span> </span><a name="local-1630121339"><a href="#local-1630121339"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-1630121340"><a href="#local-1630121340"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Databrary.HTTP.Form.Deform.html#deformMaybe%27"><span class="hs-identifier hs-var">deformMaybe'</span></a><span> </span><a href="#local-1630121339"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&lt;=&lt;</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-1630121340"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformNonEmpty"><span class="hs-identifier hs-var">deformNonEmpty</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-identifier">detectUpload</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Controller.Asset.html#FileUploadFile"><span class="hs-identifier hs-type">FileUploadFile</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Controller.Form.html#DeformActionM"><span class="hs-identifier hs-type">DeformActionM</span></a><span> </span><a href="Databrary.Store.Temp.html#TempFile"><span class="hs-identifier hs-type">TempFile</span></a><span> </span><a href="Databrary.Controller.Asset.html#FileUpload"><span class="hs-identifier hs-type">FileUpload</span></a><span>
</span><a name="line-135"></a><a name="detectUpload"><a href="Databrary.Controller.Asset.html#detectUpload"><span class="hs-identifier">detectUpload</span></a></a><span> </span><a name="local-1630121341"><a href="#local-1630121341"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-136"></a><span>  </span><span class="hs-identifier hs-var">either</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformError%27"><span class="hs-identifier hs-var">deformError'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Controller.Asset.html#FileUpload"><span class="hs-identifier hs-var">FileUpload</span></a><span> </span><a href="#local-1630121341"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-special">(</span><a href="Databrary.Store.Probe.html#probeFile"><span class="hs-identifier hs-var">probeFile</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#fileUploadName"><span class="hs-identifier hs-var">fileUploadName</span></a><span> </span><a href="#local-1630121341"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#fileUploadPath"><span class="hs-identifier hs-var">fileUploadPath</span></a><span> </span><a href="#local-1630121341"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-identifier">processAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#API"><span class="hs-identifier hs-type">API</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Controller.Asset.html#AssetTarget"><span class="hs-identifier hs-type">AssetTarget</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Types.html#ActionM"><span class="hs-identifier hs-type">ActionM</span></a><span> </span><span class="hs-identifier hs-type">Response</span><span>
</span><a name="line-140"></a><a name="processAsset"><a href="Databrary.Controller.Asset.html#processAsset"><span class="hs-identifier">processAsset</span></a></a><span> </span><a name="local-1630121342"><a href="#local-1630121342"><span class="hs-identifier">api</span></a></a><span> </span><a name="local-1630121343"><a href="#local-1630121343"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-keyword">as</span><span class="hs-glyph">@</span><a href="Databrary.Model.AssetSlot.Types.html#AssetSlot"><span class="hs-identifier hs-var">AssetSlot</span></a><span class="hs-special">{</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1630121345"><a href="#local-1630121345"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#assetSlot"><span class="hs-identifier hs-var">assetSlot</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1630121346"><a href="#local-1630121346"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-1630121343"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-142"></a><span>        </span><a href="Databrary.Controller.Asset.html#AssetTargetVolume"><span class="hs-identifier hs-var">AssetTargetVolume</span></a><span> </span><a name="local-1630121347"><a href="#local-1630121347"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#assetNoSlot"><span class="hs-identifier hs-var">assetNoSlot</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.html#blankAsset"><span class="hs-identifier hs-var">blankAsset</span></a><span> </span><a href="#local-1630121347"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-143"></a><span>        </span><a href="Databrary.Controller.Asset.html#AssetTargetSlot"><span class="hs-identifier hs-var">AssetTargetSlot</span></a><span> </span><a name="local-1630121348"><a href="#local-1630121348"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#AssetSlot"><span class="hs-identifier hs-var">AssetSlot</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.html#blankAsset"><span class="hs-identifier hs-var">blankAsset</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><a href="#local-1630121348"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1630121348"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>        </span><a href="Databrary.Controller.Asset.html#AssetTargetAsset"><span class="hs-identifier hs-var">AssetTargetAsset</span></a><span> </span><a name="local-1630121349"><a href="#local-1630121349"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-1630121349"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-145"></a><span>  </span><span class="hs-special">(</span><a name="local-1630121365"><a href="#local-1630121365"><span class="hs-identifier">as'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121366"><a href="#local-1630121366"><span class="hs-identifier">up'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Form.html#runFormFiles"><span class="hs-identifier hs-var">runFormFiles</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;file&quot;</span><span class="hs-special">,</span><span> </span><a href="Databrary.Store.Asset.html#maxAssetSize"><span class="hs-identifier hs-var">maxAssetSize</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="#local-1630121342"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Databrary.Action.Route.html#HTML"><span class="hs-identifier hs-var">HTML</span></a><span> </span><a href="Databrary.Ops.html#%3F%3E"><span class="hs-operator hs-var">?&gt;</span></a><span> </span><a href="Databrary.View.Asset.html#htmlAssetEdit"><span class="hs-identifier hs-var">htmlAssetEdit</span></a><span> </span><a href="#local-1630121343"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-146"></a><span>    </span><a href="Databrary.Controller.Form.html#csrfForm"><span class="hs-identifier hs-var">csrfForm</span></a><span>
</span><a name="line-147"></a><span>    </span><a name="local-1630121350"><a href="#local-1630121350"><span class="hs-identifier">file</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;file&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span>
</span><a name="line-148"></a><span>    </span><a name="local-1630121351"><a href="#local-1630121351"><span class="hs-identifier">upload</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;upload&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><a href="Databrary.Controller.Asset.html#deformLookup"><span class="hs-identifier hs-var">deformLookup</span></a><span> </span><span class="hs-string">&quot;Uploaded file not found.&quot;</span><span> </span><a href="Databrary.Model.Token.html#lookupUpload"><span class="hs-identifier hs-var">lookupUpload</span></a><span>
</span><a name="line-149"></a><span>    </span><a name="local-1630121354"><a href="#local-1630121354"><span class="hs-identifier">upfile</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-1630121350"><span class="hs-identifier hs-var">file</span></a><span class="hs-special">,</span><span> </span><a href="#local-1630121351"><span class="hs-identifier hs-var">upload</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-150"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1630121352"><a href="#local-1630121352"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Asset.html#FileUploadForm"><span class="hs-identifier hs-var">FileUploadForm</span></a><span> </span><a href="#local-1630121352"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-151"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1630121353"><a href="#local-1630121353"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Asset.html#FileUploadToken"><span class="hs-identifier hs-var">FileUploadToken</span></a><span> </span><a href="#local-1630121353"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-152"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="Databrary.Controller.Asset.html#AssetTargetAsset"><span class="hs-identifier hs-var">AssetTargetAsset</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1630121343"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-154"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-operator hs-var">&lt;$</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformError"><span class="hs-identifier hs-var">deformError</span></a><span> </span><span class="hs-string">&quot;File or upload required.&quot;</span><span>
</span><a name="line-155"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-operator hs-var">&lt;$</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformError"><span class="hs-identifier hs-var">deformError</span></a><span> </span><span class="hs-string">&quot;Conflicting uploaded files found.&quot;</span><span>
</span><a name="line-156"></a><span>    </span><a name="local-1630121355"><a href="#local-1630121355"><span class="hs-identifier">up</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Databrary.Controller.Asset.html#detectUpload"><span class="hs-identifier hs-var">detectUpload</span></a><span> </span><a href="#local-1630121354"><span class="hs-identifier hs-var">upfile</span></a><span>
</span><a name="line-157"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1630121356"><a href="#local-1630121356"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetFormat"><span class="hs-identifier hs-var">assetFormat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Databrary.Store.Probe.html#probeFormat"><span class="hs-identifier hs-var">probeFormat</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Controller.Asset.html#fileUploadProbe"><span class="hs-identifier hs-var">fileUploadProbe</span></a><span class="hs-special">)</span><span> </span><a href="#local-1630121355"><span class="hs-identifier hs-var">up</span></a><span>
</span><a name="line-158"></a><span>    </span><a name="local-1630121357"><a href="#local-1630121357"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;name&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetName"><span class="hs-identifier hs-var">assetName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">decodeUtf8</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Model.Format.html#dropFormatExtension"><span class="hs-identifier hs-var">dropFormatExtension</span></a><span> </span><a href="#local-1630121356"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformOptional"><span class="hs-identifier hs-var">deformOptional</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.HTTP.Form.Deform.html#deformNonEmpty"><span class="hs-identifier hs-var">deformNonEmpty</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>    </span><a name="local-1630121358"><a href="#local-1630121358"><span class="hs-identifier">classification</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;classification&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetRelease"><span class="hs-identifier hs-var">assetRelease</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformOptional"><span class="hs-identifier hs-var">deformOptional</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.HTTP.Form.Deform.html#deformNonEmpty"><span class="hs-identifier hs-var">deformNonEmpty</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>    </span><a name="local-1630121364"><a href="#local-1630121364"><span class="hs-identifier">slot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-161"></a><span>      </span><span class="hs-string">&quot;container&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="Databrary.Model.Slot.Types.html#slotContainer"><span class="hs-identifier hs-var">slotContainer</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1630121346"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.Controller.Asset.html#deformLookup"><span class="hs-identifier hs-var">deformLookup</span></a><span> </span><span class="hs-string">&quot;Container not found.&quot;</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Container.html#lookupVolumeContainer"><span class="hs-identifier hs-var">lookupVolumeContainer</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetVolume"><span class="hs-identifier hs-var">assetVolume</span></a><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>      </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1630121359"><a href="#local-1630121359"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;position&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-1630121360"><a href="#local-1630121360"><span class="hs-identifier">seg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.Slot.Types.html#slotSegment"><span class="hs-identifier hs-var">slotSegment</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-1630121346"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-164"></a><span>            </span><a name="local-1630121361"><a href="#local-1630121361"><span class="hs-identifier">dur</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetDuration"><span class="hs-identifier hs-var">assetDuration</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Databrary.Store.Probe.html#probeLength"><span class="hs-identifier hs-var">probeLength</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Controller.Asset.html#fileUploadProbe"><span class="hs-identifier hs-var">fileUploadProbe</span></a><span class="hs-special">)</span><span> </span><a href="#local-1630121355"><span class="hs-identifier hs-var">up</span></a><span>
</span><a name="line-165"></a><span>        </span><a name="local-1630121362"><a href="#local-1630121362"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Segment.html#lowerBound"><span class="hs-identifier hs-var">lowerBound</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Model.Segment.html#segmentRange"><span class="hs-identifier hs-var">segmentRange</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-1630121360"><span class="hs-identifier hs-var">seg</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformOptional"><span class="hs-identifier hs-var">deformOptional</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.HTTP.Form.Deform.html#deformNonEmpty"><span class="hs-identifier hs-var">deformNonEmpty</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>        </span><a href="Databrary.Model.Slot.Types.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><a href="#local-1630121359"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><a href="Databrary.Model.Segment.html#fullSegment"><span class="hs-identifier hs-var">fullSegment</span></a><span>
</span><a name="line-167"></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1630121363"><a href="#local-1630121363"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Model.Segment.html#Segment"><span class="hs-identifier hs-var">Segment</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Range</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">bounded</span><span> </span><a href="#local-1630121363"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630121363"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Databrary.Model.Segment.html#segmentLength"><span class="hs-identifier hs-var">segmentLength</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-1630121360"><span class="hs-identifier hs-var">seg</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="#local-1630121361"><span class="hs-identifier hs-var">dur</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>          </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.Ops.html#orElseM"><span class="hs-identifier hs-var">orElseM</span></a><span> </span><a href="#local-1630121362"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lift</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Store.Probe.html#probeAutoPosition"><span class="hs-identifier hs-var">probeAutoPosition</span></a><span> </span><a href="#local-1630121359"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Controller.Asset.html#fileUploadProbe"><span class="hs-identifier hs-var">fileUploadProbe</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isNothing</span><span> </span><a href="#local-1630121346"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><a href="#local-1630121361"><span class="hs-identifier hs-var">dur</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-1630121355"><span class="hs-identifier hs-var">up</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-170"></a><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">as</span><span>
</span><a name="line-171"></a><span>        </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-172"></a><span>          </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>            </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetName"><span class="hs-identifier hs-var">assetName</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630121357"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-174"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRelease"><span class="hs-identifier hs-var">assetRelease</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630121358"><span class="hs-identifier hs-var">classification</span></a><span>
</span><a name="line-175"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetFormat"><span class="hs-identifier hs-var">assetFormat</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630121356"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-176"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-177"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#assetSlot"><span class="hs-identifier hs-var">assetSlot</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630121364"><span class="hs-identifier hs-var">slot</span></a><span>
</span><a name="line-179"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-180"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-1630121355"><span class="hs-identifier hs-var">up</span></a><span>
</span><a name="line-181"></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>  </span><a name="local-1630121376"><a href="#local-1630121376"><span class="hs-identifier">as''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1630121365"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-1630121367"><a href="#local-1630121367"><span class="hs-identifier">up</span></a></a><span class="hs-glyph">@</span><a href="Databrary.Controller.Asset.html#FileUpload"><span class="hs-identifier hs-var">FileUpload</span></a><span class="hs-special">{</span><span> </span><a href="Databrary.Controller.Asset.html#fileUploadFile"><span class="hs-identifier hs-var">fileUploadFile</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1630121368"><a href="#local-1630121368"><span class="hs-identifier">upfile</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-183"></a><span>    </span><a name="local-1630121369"><a href="#local-1630121369"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.Asset.html#addAsset"><span class="hs-identifier hs-var">addAsset</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121365"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>      </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121365"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetName"><span class="hs-identifier hs-var">assetName</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">TE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">decodeUtf8</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Asset.html#fileUploadName"><span class="hs-identifier hs-var">fileUploadName</span></a><span> </span><a href="#local-1630121368"><span class="hs-identifier hs-var">upfile</span></a><span>
</span><a name="line-186"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetDuration"><span class="hs-identifier hs-var">assetDuration</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-187"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetSize"><span class="hs-identifier hs-var">assetSize</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-188"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetSHA1"><span class="hs-identifier hs-var">assetSHA1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-189"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-190"></a><span>      </span><span class="hs-special">}</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#fileUploadPath"><span class="hs-identifier hs-var">fileUploadPath</span></a><span> </span><a href="#local-1630121368"><span class="hs-identifier hs-var">upfile</span></a><span class="hs-special">)</span><span>
</span><a name="line-191"></a><span>    </span><a href="Databrary.Controller.Asset.html#fileUploadRemove"><span class="hs-identifier hs-var">fileUploadRemove</span></a><span> </span><a href="#local-1630121368"><span class="hs-identifier hs-var">upfile</span></a><span>
</span><a name="line-192"></a><span>    </span><a name="local-1630121370"><a href="#local-1630121370"><span class="hs-identifier">td</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.Transcode.html#checkAlreadyTranscoded"><span class="hs-identifier hs-var">checkAlreadyTranscoded</span></a><span> </span><a href="#local-1630121369"><span class="hs-identifier hs-var">a'</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#fileUploadProbe"><span class="hs-identifier hs-var">fileUploadProbe</span></a><span> </span><a href="#local-1630121367"><span class="hs-identifier hs-var">up</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>    </span><a name="local-1630121371"><a href="#local-1630121371"><span class="hs-identifier">te</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><a href="Databrary.Store.Transcoder.html#transcodeEnabled"><span class="hs-identifier hs-var">transcodeEnabled</span></a><span>
</span><a name="line-194"></a><span>    </span><a name="local-1630121375"><a href="#local-1630121375"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Databrary.Controller.Asset.html#fileUploadProbe"><span class="hs-identifier hs-var">fileUploadProbe</span></a><span> </span><a href="#local-1630121367"><span class="hs-identifier hs-var">up</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-195"></a><span>      </span><a href="Databrary.Store.Probe.html#ProbeAV"><span class="hs-identifier hs-var">ProbeAV</span></a><span class="hs-special">{</span><span> </span><a href="Databrary.Store.Probe.html#probeAV"><span class="hs-identifier hs-var">probeAV</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-1630121372"><a href="#local-1630121372"><span class="hs-identifier">av</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1630121370"><span class="hs-identifier hs-var">td</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-196"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1630121369"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121369"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetDuration"><span class="hs-identifier hs-var">assetDuration</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Store.AV.html#avProbeLength"><span class="hs-identifier hs-var">avProbeLength</span></a><span> </span><a href="#local-1630121372"><span class="hs-identifier hs-var">av</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-197"></a><span>      </span><a name="local-1630121373"><a href="#local-1630121373"><span class="hs-identifier">probe</span></a></a><span class="hs-glyph">@</span><a href="Databrary.Store.Probe.html#ProbeAV"><span class="hs-identifier hs-var">ProbeAV</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-1630121371"><span class="hs-identifier hs-var">te</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-198"></a><span>        </span><a name="local-1630121374"><a href="#local-1630121374"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.Transcode.html#addTranscode"><span class="hs-identifier hs-var">addTranscode</span></a><span> </span><a href="#local-1630121369"><span class="hs-identifier hs-var">a'</span></a><span> </span><a href="Databrary.Model.Segment.html#fullSegment"><span class="hs-identifier hs-var">fullSegment</span></a><span> </span><a href="Databrary.Model.Transcode.html#defaultTranscodeOptions"><span class="hs-identifier hs-var">defaultTranscodeOptions</span></a><span> </span><a href="#local-1630121373"><span class="hs-identifier hs-var">probe</span></a><span>
</span><a name="line-199"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Store.Transcode.html#forkTranscode"><span class="hs-identifier hs-var">forkTranscode</span></a><span> </span><a href="#local-1630121374"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-200"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Transcode.Types.html#transcodeAsset"><span class="hs-identifier hs-var">transcodeAsset</span></a><span> </span><a href="#local-1630121374"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-201"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1630121369"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-202"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-1630121343"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-203"></a><span>      </span><a href="Databrary.Controller.Asset.html#AssetTargetAsset"><span class="hs-identifier hs-var">AssetTargetAsset</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Model.AssetRevision.html#replaceAsset"><span class="hs-identifier hs-var">replaceAsset</span></a><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1630121375"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-204"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.html#fixAssetSlotDuration"><span class="hs-identifier hs-var">fixAssetSlotDuration</span></a><span> </span><a href="#local-1630121365"><span class="hs-identifier hs-var">as'</span></a><span>
</span><a name="line-206"></a><span>      </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630121375"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-207"></a><span>        </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121375"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>          </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetName"><span class="hs-identifier hs-var">assetName</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetName"><span class="hs-identifier hs-var">assetName</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121365"><span class="hs-identifier hs-var">as'</span></a><span>
</span><a name="line-209"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-210"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-211"></a><span>      </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>    </span><a href="#local-1630121366"><span class="hs-identifier hs-var">up'</span></a><span>
</span><a name="line-213"></a><span>  </span><a name="local-1630121377"><a href="#local-1630121377"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.Asset.html#changeAsset"><span class="hs-identifier hs-var">changeAsset</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121376"><span class="hs-identifier hs-var">as''</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-214"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.AssetSlot.html#changeAssetSlot"><span class="hs-identifier hs-var">changeAssetSlot</span></a><span> </span><a href="#local-1630121376"><span class="hs-identifier hs-var">as''</span></a><span>
</span><a name="line-215"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetRelease"><span class="hs-identifier hs-var">assetRelease</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121377"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Databrary.Model.Release.Types.html#ReleasePUBLIC"><span class="hs-identifier hs-var">ReleasePUBLIC</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRelease"><span class="hs-identifier hs-var">assetRelease</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121345"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Databrary.Model.Release.Types.html#ReleasePUBLIC"><span class="hs-identifier hs-var">ReleasePUBLIC</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-216"></a><span>    </span><a href="Databrary.Controller.Notification.html#createVolumeNotification"><span class="hs-identifier hs-var">createVolumeNotification</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Asset.Types.html#assetVolume"><span class="hs-identifier hs-var">assetVolume</span></a><span> </span><a href="#local-1630121377"><span class="hs-identifier hs-var">a'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1630121378"><a href="#local-1630121378"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-1630121378"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Databrary.Model.Notification.Notice.html#NoticeReleaseAsset"><span class="hs-identifier hs-var">NoticeReleaseAsset</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>      </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Notification.Types.html#notificationContainerId"><span class="hs-identifier hs-var">notificationContainerId</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.Container.Types.html#containerId"><span class="hs-identifier hs-var">containerId</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Model.Container.Types.html#containerRow"><span class="hs-identifier hs-var">containerRow</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.Model.Slot.Types.html#slotContainer"><span class="hs-identifier hs-var">slotContainer</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#assetSlot"><span class="hs-identifier hs-var">assetSlot</span></a><span> </span><a href="#local-1630121376"><span class="hs-identifier hs-var">as''</span></a><span>
</span><a name="line-218"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Notification.Types.html#notificationSegment"><span class="hs-identifier hs-var">notificationSegment</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.Slot.Types.html#slotSegment"><span class="hs-identifier hs-var">slotSegment</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#assetSlot"><span class="hs-identifier hs-var">assetSlot</span></a><span> </span><a href="#local-1630121376"><span class="hs-identifier hs-var">as''</span></a><span>
</span><a name="line-219"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Notification.Types.html#notificationAssetId"><span class="hs-identifier hs-var">notificationAssetId</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetId"><span class="hs-identifier hs-var">assetId</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121377"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-220"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Notification.Types.html#notificationRelease"><span class="hs-identifier hs-var">notificationRelease</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRelease"><span class="hs-identifier hs-var">assetRelease</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><a href="#local-1630121377"><span class="hs-identifier hs-var">a'</span></a><span>
</span><a name="line-221"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-222"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-1630121342"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-223"></a><span>    </span><a href="Databrary.Action.Route.html#JSON"><span class="hs-identifier hs-var">JSON</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Response.html#okResponse"><span class="hs-identifier hs-var">okResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.JSON.html#recordEncoding"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">recordEncoding</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.html#assetSlotJSON"><span class="hs-identifier hs-var">assetSlotJSON</span></a><span> </span><a href="#local-1630121376"><span class="hs-identifier hs-var">as''</span></a><span>
</span><a name="line-224"></a><span>    </span><a href="Databrary.Action.Route.html#HTML"><span class="hs-identifier hs-var">HTML</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.html#otherRouteResponse"><span class="hs-identifier hs-var">otherRouteResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="Databrary.Controller.Asset.html#viewAsset"><span class="hs-identifier hs-var">viewAsset</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630121342"><span class="hs-identifier hs-var">api</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetId"><span class="hs-identifier hs-var">assetId</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121376"><span class="hs-identifier hs-var">as''</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span class="hs-identifier">postAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#API"><span class="hs-identifier hs-type">API</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Asset.Types.html#Asset"><span class="hs-identifier hs-type">Asset</span></a><span class="hs-special">)</span><span>
</span><a name="line-227"></a><a name="postAsset"><a href="Databrary.Controller.Asset.html#postAsset"><span class="hs-identifier">postAsset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#multipartAction"><span class="hs-identifier hs-var">multipartAction</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">POST</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathAPI"><span class="hs-identifier hs-var">pathAPI</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1630121379"><a href="#local-1630121379"><span class="hs-identifier">api</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121380"><a href="#local-1630121380"><span class="hs-identifier">ai</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-228"></a><span>  </span><a name="local-1630121381"><a href="#local-1630121381"><span class="hs-identifier">asset</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Asset.html#getAsset"><span class="hs-identifier hs-var">getAsset</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionEDIT"><span class="hs-identifier hs-var">PermissionEDIT</span></a><span> </span><a href="#local-1630121380"><span class="hs-identifier hs-var">ai</span></a><span>
</span><a name="line-229"></a><span>  </span><a name="local-1630121382"><a href="#local-1630121382"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.AssetRevision.html#assetIsReplaced"><span class="hs-identifier hs-var">assetIsReplaced</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121381"><span class="hs-identifier hs-var">asset</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-1630121382"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Response.html#result"><span class="hs-identifier hs-var">result</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-231"></a><span>    </span><a href="Databrary.Action.Response.html#response"><span class="hs-identifier hs-var">response</span></a><span> </span><span class="hs-identifier hs-var">conflict409</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;This file has already been replaced.&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">T</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>  </span><a href="Databrary.Controller.Asset.html#processAsset"><span class="hs-identifier hs-var">processAsset</span></a><span> </span><a href="#local-1630121379"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Asset.html#AssetTargetAsset"><span class="hs-identifier hs-var">AssetTargetAsset</span></a><span> </span><a href="#local-1630121381"><span class="hs-identifier hs-var">asset</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-identifier">viewAssetEdit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Asset.Types.html#Asset"><span class="hs-identifier hs-type">Asset</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><a name="viewAssetEdit"><a href="Databrary.Controller.Asset.html#viewAssetEdit"><span class="hs-identifier">viewAssetEdit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">GET</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathHTML"><span class="hs-identifier hs-var">pathHTML</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3E%2F%3E"><span class="hs-operator hs-var">&gt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;edit&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1630121383"><a href="#local-1630121383"><span class="hs-identifier">ai</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-236"></a><span>  </span><a name="local-1630121384"><a href="#local-1630121384"><span class="hs-identifier">asset</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Asset.html#getAsset"><span class="hs-identifier hs-var">getAsset</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionEDIT"><span class="hs-identifier hs-var">PermissionEDIT</span></a><span> </span><a href="#local-1630121383"><span class="hs-identifier hs-var">ai</span></a><span>
</span><a name="line-237"></a><span>  </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Form.html#blankForm"><span class="hs-identifier hs-var">blankForm</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.View.Asset.html#htmlAssetEdit"><span class="hs-identifier hs-var">htmlAssetEdit</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#AssetTargetAsset"><span class="hs-identifier hs-var">AssetTargetAsset</span></a><span> </span><a href="#local-1630121384"><span class="hs-identifier hs-var">asset</span></a><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-identifier">createAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#API"><span class="hs-identifier hs-type">API</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Volume.Types.html#Volume"><span class="hs-identifier hs-type">Volume</span></a><span class="hs-special">)</span><span>
</span><a name="line-240"></a><a name="createAsset"><a href="Databrary.Controller.Asset.html#createAsset"><span class="hs-identifier">createAsset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#multipartAction"><span class="hs-identifier hs-var">multipartAction</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">POST</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathAPI"><span class="hs-identifier hs-var">pathAPI</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;asset&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1630121385"><a href="#local-1630121385"><span class="hs-identifier">api</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121386"><a href="#local-1630121386"><span class="hs-identifier">vi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-241"></a><span>  </span><a name="local-1630121387"><a href="#local-1630121387"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Volume.html#getVolume"><span class="hs-identifier hs-var">getVolume</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionEDIT"><span class="hs-identifier hs-var">PermissionEDIT</span></a><span> </span><a href="#local-1630121386"><span class="hs-identifier hs-var">vi</span></a><span>
</span><a name="line-242"></a><span>  </span><a href="Databrary.Controller.Asset.html#processAsset"><span class="hs-identifier hs-var">processAsset</span></a><span> </span><a href="#local-1630121385"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Asset.html#AssetTargetVolume"><span class="hs-identifier hs-var">AssetTargetVolume</span></a><span> </span><a href="#local-1630121387"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-identifier">viewAssetCreate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Volume.Types.html#Volume"><span class="hs-identifier hs-type">Volume</span></a><span class="hs-special">)</span><span>
</span><a name="line-245"></a><a name="viewAssetCreate"><a href="Databrary.Controller.Asset.html#viewAssetCreate"><span class="hs-identifier">viewAssetCreate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">GET</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathHTML"><span class="hs-identifier hs-var">pathHTML</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3E%2F%3E"><span class="hs-operator hs-var">&gt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;asset&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1630121388"><a href="#local-1630121388"><span class="hs-identifier">vi</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-246"></a><span>  </span><a name="local-1630121389"><a href="#local-1630121389"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Volume.html#getVolume"><span class="hs-identifier hs-var">getVolume</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionEDIT"><span class="hs-identifier hs-var">PermissionEDIT</span></a><span> </span><a href="#local-1630121388"><span class="hs-identifier hs-var">vi</span></a><span>
</span><a name="line-247"></a><span>  </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Form.html#blankForm"><span class="hs-identifier hs-var">blankForm</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.View.Asset.html#htmlAssetEdit"><span class="hs-identifier hs-var">htmlAssetEdit</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#AssetTargetVolume"><span class="hs-identifier hs-var">AssetTargetVolume</span></a><span> </span><a href="#local-1630121389"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-identifier">createSlotAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#API"><span class="hs-identifier hs-type">API</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Slot.Types.html#Slot"><span class="hs-identifier hs-type">Slot</span></a><span class="hs-special">)</span><span>
</span><a name="line-250"></a><a name="createSlotAsset"><a href="Databrary.Controller.Asset.html#createSlotAsset"><span class="hs-identifier">createSlotAsset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#multipartAction"><span class="hs-identifier hs-var">multipartAction</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">POST</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathAPI"><span class="hs-identifier hs-var">pathAPI</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathSlotId"><span class="hs-identifier hs-var">pathSlotId</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;asset&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1630121390"><a href="#local-1630121390"><span class="hs-identifier">api</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121391"><a href="#local-1630121391"><span class="hs-identifier">si</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-251"></a><span>  </span><a name="local-1630121392"><a href="#local-1630121392"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Slot.html#getSlot"><span class="hs-identifier hs-var">getSlot</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionEDIT"><span class="hs-identifier hs-var">PermissionEDIT</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-1630121391"><span class="hs-identifier hs-var">si</span></a><span>
</span><a name="line-252"></a><span>  </span><a href="Databrary.Controller.Asset.html#processAsset"><span class="hs-identifier hs-var">processAsset</span></a><span> </span><a href="#local-1630121390"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Asset.html#AssetTargetSlot"><span class="hs-identifier hs-var">AssetTargetSlot</span></a><span> </span><a href="#local-1630121392"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-identifier">viewSlotAssetCreate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Slot.Types.html#Slot"><span class="hs-identifier hs-type">Slot</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><a name="viewSlotAssetCreate"><a href="Databrary.Controller.Asset.html#viewSlotAssetCreate"><span class="hs-identifier">viewSlotAssetCreate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">GET</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathHTML"><span class="hs-identifier hs-var">pathHTML</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3E%2F%3E"><span class="hs-operator hs-var">&gt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathSlotId"><span class="hs-identifier hs-var">pathSlotId</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;asset&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1630121393"><a href="#local-1630121393"><span class="hs-identifier">si</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-256"></a><span>  </span><a name="local-1630121394"><a href="#local-1630121394"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Slot.html#getSlot"><span class="hs-identifier hs-var">getSlot</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionEDIT"><span class="hs-identifier hs-var">PermissionEDIT</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-1630121393"><span class="hs-identifier hs-var">si</span></a><span>
</span><a name="line-257"></a><span>  </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Form.html#blankForm"><span class="hs-identifier hs-var">blankForm</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.View.Asset.html#htmlAssetEdit"><span class="hs-identifier hs-var">htmlAssetEdit</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Asset.html#AssetTargetSlot"><span class="hs-identifier hs-var">AssetTargetSlot</span></a><span> </span><a href="#local-1630121394"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-identifier">deleteAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#API"><span class="hs-identifier hs-type">API</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Asset.Types.html#Asset"><span class="hs-identifier hs-type">Asset</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><a name="deleteAsset"><a href="Databrary.Controller.Asset.html#deleteAsset"><span class="hs-identifier">deleteAsset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">DELETE</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathAPI"><span class="hs-identifier hs-var">pathAPI</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1630121395"><a href="#local-1630121395"><span class="hs-identifier">api</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121396"><a href="#local-1630121396"><span class="hs-identifier">ai</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-261"></a><span>  </span><a href="Databrary.Controller.Permission.html#guardVerfHeader"><span class="hs-identifier hs-var">guardVerfHeader</span></a><span>
</span><a name="line-262"></a><span>  </span><a name="local-1630121397"><a href="#local-1630121397"><span class="hs-identifier">asset</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Asset.html#getAsset"><span class="hs-identifier hs-var">getAsset</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionEDIT"><span class="hs-identifier hs-var">PermissionEDIT</span></a><span> </span><a href="#local-1630121396"><span class="hs-identifier hs-var">ai</span></a><span>
</span><a name="line-263"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1630121398"><a href="#local-1630121398"><span class="hs-identifier">asset'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630121397"><span class="hs-identifier hs-var">asset</span></a><span class="hs-special">{</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#assetSlot"><span class="hs-identifier hs-var">assetSlot</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-264"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.AssetSlot.html#changeAssetSlot"><span class="hs-identifier hs-var">changeAssetSlot</span></a><span> </span><a href="#local-1630121398"><span class="hs-identifier hs-var">asset'</span></a><span>
</span><a name="line-265"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-1630121395"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-266"></a><span>    </span><a href="Databrary.Action.Route.html#JSON"><span class="hs-identifier hs-var">JSON</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Response.html#okResponse"><span class="hs-identifier hs-var">okResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.JSON.html#recordEncoding"><span class="hs-identifier hs-var">JSON</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">recordEncoding</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.html#assetSlotJSON"><span class="hs-identifier hs-var">assetSlotJSON</span></a><span> </span><a href="#local-1630121398"><span class="hs-identifier hs-var">asset'</span></a><span>
</span><a name="line-267"></a><span>    </span><a href="Databrary.Action.Route.html#HTML"><span class="hs-identifier hs-var">HTML</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.html#otherRouteResponse"><span class="hs-identifier hs-var">otherRouteResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="Databrary.Controller.Asset.html#viewAsset"><span class="hs-identifier hs-var">viewAsset</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630121395"><span class="hs-identifier hs-var">api</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetId"><span class="hs-identifier hs-var">assetId</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.Asset.Types.html#assetRow"><span class="hs-identifier hs-var">assetRow</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSlot.Types.html#slotAsset"><span class="hs-identifier hs-var">slotAsset</span></a><span> </span><a href="#local-1630121398"><span class="hs-identifier hs-var">asset'</span></a><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-identifier">downloadAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Asset.Types.html#Asset"><span class="hs-identifier hs-type">Asset</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Segment.html#Segment"><span class="hs-identifier hs-type">Segment</span></a><span class="hs-special">)</span><span>
</span><a name="line-270"></a><a name="downloadAsset"><a href="Databrary.Controller.Asset.html#downloadAsset"><span class="hs-identifier">downloadAsset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">GET</span><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathSegment"><span class="hs-identifier hs-var">pathSegment</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;download&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1630121399"><a href="#local-1630121399"><span class="hs-identifier">ai</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121400"><a href="#local-1630121400"><span class="hs-identifier">seg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-271"></a><span>  </span><a name="local-1630121401"><a href="#local-1630121401"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Asset.html#getAsset"><span class="hs-identifier hs-var">getAsset</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionPUBLIC"><span class="hs-identifier hs-var">PermissionPUBLIC</span></a><span> </span><a href="#local-1630121399"><span class="hs-identifier hs-var">ai</span></a><span>
</span><a name="line-272"></a><span>  </span><a name="local-1630121402"><a href="#local-1630121402"><span class="hs-identifier">inline</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.HTTP.Request.html#lookupQueryParameters"><span class="hs-identifier hs-var">lookupQueryParameters</span></a><span> </span><span class="hs-string">&quot;inline&quot;</span><span>
</span><a name="line-273"></a><span>  </span><a href="Databrary.Controller.AssetSegment.html#serveAssetSegment"><span class="hs-identifier hs-var">serveAssetSegment</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-1630121402"><span class="hs-identifier hs-var">inline</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSegment.Types.html#newAssetSegment"><span class="hs-identifier hs-var">newAssetSegment</span></a><span> </span><a href="#local-1630121401"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1630121400"><span class="hs-identifier hs-var">seg</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-identifier">thumbAsset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Asset.Types.html#Asset"><span class="hs-identifier hs-type">Asset</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Segment.html#Segment"><span class="hs-identifier hs-type">Segment</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><a name="thumbAsset"><a href="Databrary.Controller.Asset.html#thumbAsset"><span class="hs-identifier">thumbAsset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">GET</span><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathSegment"><span class="hs-identifier hs-var">pathSegment</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;thumb&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-1630121403"><a href="#local-1630121403"><span class="hs-identifier">ai</span></a></a><span class="hs-special">,</span><span> </span><a name="local-1630121404"><a href="#local-1630121404"><span class="hs-identifier">seg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-277"></a><span>  </span><a name="local-1630121405"><a href="#local-1630121405"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Asset.html#getAsset"><span class="hs-identifier hs-var">getAsset</span></a><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionPUBLIC"><span class="hs-identifier hs-var">PermissionPUBLIC</span></a><span> </span><a href="#local-1630121403"><span class="hs-identifier hs-var">ai</span></a><span>
</span><a name="line-278"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.AssetSegment.html#assetSegmentInterp"><span class="hs-identifier hs-var">assetSegmentInterp</span></a><span> </span><span class="hs-number">0.25</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Model.AssetSegment.Types.html#newAssetSegment"><span class="hs-identifier hs-var">newAssetSegment</span></a><span> </span><a href="#local-1630121405"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-1630121404"><span class="hs-identifier hs-var">seg</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-279"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="Databrary.Model.Format.html#formatIsImage"><span class="hs-identifier hs-var">formatIsImage</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Databrary.Model.Asset.html#assetBacked"><span class="hs-identifier hs-var">assetBacked</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Databrary.Model.Permission.html#dataPermission"><span class="hs-identifier hs-var">dataPermission</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionNONE"><span class="hs-identifier hs-var">PermissionNONE</span></a><span>
</span><a name="line-280"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.html#otherRouteResponse"><span class="hs-identifier hs-var">otherRouteResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="Databrary.Controller.Asset.html#downloadAsset"><span class="hs-identifier hs-var">downloadAsset</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.AssetSegment.Types.html#assetSegment"><span class="hs-identifier hs-var">assetSegment</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.html#otherRouteResponse"><span class="hs-identifier hs-var">otherRouteResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="Databrary.Controller.Format.html#formatIcon"><span class="hs-identifier hs-var">formatIcon</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-282"></a></pre></body></html>