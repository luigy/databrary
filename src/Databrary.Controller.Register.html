<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Register</span><span>
</span><a name="line-3"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Databrary.Controller.Register.html#viewPasswordReset"><span class="hs-identifier hs-var">viewPasswordReset</span></a><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Register.html#postPasswordReset"><span class="hs-identifier hs-var">postPasswordReset</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Register.html#viewRegister"><span class="hs-identifier hs-var">viewRegister</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Register.html#postRegister"><span class="hs-identifier hs-var">postRegister</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Register.html#resendInvestigator"><span class="hs-identifier hs-var">resendInvestigator</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Builder</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BSB</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Monoid</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TL</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span class="hs-operator">.</span><span class="hs-identifier">Encoding</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TLE</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Ops.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Ops</span></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Has.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Has</span></a><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Service-Mail.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Mail</span></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Static-Fillin.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Static</span><span class="hs-operator">.</span><span class="hs-identifier">Fillin</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Model-Permission.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Permission</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Model-Id.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Id</span></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Model-Party.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Party</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Model-Identity.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Identity</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Model-Token.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Token</span></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-HTTP-Form-Deform.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Form</span><span class="hs-operator">.</span><span class="hs-identifier">Deform</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-HTTP-Path-Parser.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Path</span><span class="hs-operator">.</span><span class="hs-identifier">Parser</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Action.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Action</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Controller-Paths.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Paths</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Controller-Form.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Form</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Controller-Permission.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Permission</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Controller-Party.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Party</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Controller-Token.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Token</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-Controller-Angular.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Angular</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="../Databrary-View-Register.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">View</span><span class="hs-operator">.</span><span class="hs-identifier">Register</span></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-identifier">resetPasswordMail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">BS</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span> </span><a href="Databrary.Model.Party.Types.html#SiteAuth"><span class="hs-identifier hs-type">SiteAuth</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">T</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">TL</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TL</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Types.html#ActionM"><span class="hs-identifier hs-type">ActionM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><a name="resetPasswordMail"><a href="Databrary.Controller.Register.html#resetPasswordMail"><span class="hs-identifier">resetPasswordMail</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-1630252240"><a href="#local-1630252240"><span class="hs-identifier">email</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1630252241"><a href="#local-1630252241"><span class="hs-identifier">subj</span></a></a><span> </span><a name="local-1630252242"><a href="#local-1630252242"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-39"></a><span>  </span><a href="Databrary.Service.Mail.html#sendMail"><span class="hs-identifier hs-var">sendMail</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1630252240"><span class="hs-identifier hs-var">email</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1630252241"><span class="hs-identifier hs-var">subj</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630252242"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-identifier">resetPasswordMail</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-1630252243"><a href="#local-1630252243"><span class="hs-identifier">auth</span></a></a><span class="hs-special">)</span><span> </span><a name="local-1630252244"><a href="#local-1630252244"><span class="hs-identifier">subj</span></a></a><span> </span><a name="local-1630252245"><a href="#local-1630252245"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-41"></a><span>  </span><a name="local-1630252246"><a href="#local-1630252246"><span class="hs-identifier">tok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Model.Token.html#loginTokenId"><span class="hs-identifier hs-var">loginTokenId</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.Model.Token.html#createLoginToken"><span class="hs-identifier hs-var">createLoginToken</span></a><span> </span><a href="#local-1630252243"><span class="hs-identifier hs-var">auth</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-42"></a><span>  </span><a name="local-1630252247"><a href="#local-1630252247"><span class="hs-identifier">req</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Has.html#peek"><span class="hs-identifier hs-var">peek</span></a><span>
</span><a name="line-43"></a><span>  </span><a href="Databrary.Service.Mail.html#sendMail"><span class="hs-identifier hs-var">sendMail</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><a href="#local-1630252243"><span class="hs-identifier hs-var">auth</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-1630252244"><span class="hs-identifier hs-var">subj</span></a><span>
</span><a name="line-44"></a><span>    </span><span class="hs-special">(</span><a href="#local-1630252245"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">TLE</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">decodeLatin1</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BSB</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">toLazyByteString</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Route.html#actionURL"><span class="hs-identifier hs-var">actionURL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1630252247"><span class="hs-identifier hs-var">req</span></a><span class="hs-special">)</span><span> </span><a href="Databrary.Controller.Token.html#viewLoginToken"><span class="hs-identifier hs-var">viewLoginToken</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#HTML"><span class="hs-identifier hs-var">HTML</span></a><span class="hs-special">,</span><span> </span><a href="#local-1630252246"><span class="hs-identifier hs-var">tok</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-identifier">viewRegister</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><a name="viewRegister"><a href="Databrary.Controller.Register.html#viewRegister"><span class="hs-identifier">viewRegister</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">GET</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathHTML"><span class="hs-identifier hs-var">pathHTML</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;user&quot;</span><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;register&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-48"></a><span>  </span><a href="Databrary.Controller.Angular.html#angular"><span class="hs-identifier hs-var">angular</span></a><span>
</span><a name="line-49"></a><span>  </span><a href="Databrary.Model.Identity.html#maybeIdentity"><span class="hs-identifier hs-var">maybeIdentity</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">(</span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Form.html#blankForm"><span class="hs-identifier hs-var">blankForm</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.View.Register.html#htmlRegister"><span class="hs-identifier hs-var">htmlRegister</span></a><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.html#otherRouteResponse"><span class="hs-identifier hs-var">otherRouteResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="Databrary.Controller.Party.html#viewParty"><span class="hs-identifier hs-var">viewParty</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#HTML"><span class="hs-identifier hs-var">HTML</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Controller.Paths.html#TargetProfile"><span class="hs-identifier hs-var">TargetProfile</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-identifier">postRegister</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><a href="Databrary.Action.Route.html#API"><span class="hs-identifier hs-type">API</span></a><span>
</span><a name="line-54"></a><a name="postRegister"><a href="Databrary.Controller.Register.html#postRegister"><span class="hs-identifier">postRegister</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">POST</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathAPI"><span class="hs-identifier hs-var">pathAPI</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;user&quot;</span><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;register&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1630252248"><a href="#local-1630252248"><span class="hs-identifier">api</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withoutAuth"><span class="hs-identifier hs-var">withoutAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-55"></a><span>  </span><a name="local-1630252255"><a href="#local-1630252255"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Form.html#runForm"><span class="hs-identifier hs-var">runForm</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630252248"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Databrary.Action.Route.html#HTML"><span class="hs-identifier hs-var">HTML</span></a><span> </span><a href="Databrary.Ops.html#%3F%3E"><span class="hs-operator hs-var">?&gt;</span></a><span> </span><a href="Databrary.View.Register.html#htmlRegister"><span class="hs-identifier hs-var">htmlRegister</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-56"></a><span>    </span><a name="local-1630252249"><a href="#local-1630252249"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;sortname&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.HTTP.Form.Deform.html#deformRequired"><span class="hs-identifier hs-var">deformRequired</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span>    </span><a name="local-1630252250"><a href="#local-1630252250"><span class="hs-identifier">prename</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;prename&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformNonEmpty"><span class="hs-identifier hs-var">deformNonEmpty</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span>
</span><a name="line-58"></a><span>    </span><a name="local-1630252251"><a href="#local-1630252251"><span class="hs-identifier">email</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;email&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><a href="Databrary.Controller.Form.html#emailTextForm"><span class="hs-identifier hs-var">emailTextForm</span></a><span>
</span><a name="line-59"></a><span>    </span><a name="local-1630252252"><a href="#local-1630252252"><span class="hs-identifier">affiliation</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;affiliation&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deformNonEmpty"><span class="hs-identifier hs-var">deformNonEmpty</span></a><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-string">&quot;agreement&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.HTTP.Form.Deform.html#deformCheck"><span class="hs-identifier hs-var">deformCheck</span></a><span> </span><span class="hs-string">&quot;You must consent to the user agreement.&quot;</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#deform"><span class="hs-identifier hs-var">deform</span></a><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-1630252253"><a href="#local-1630252253"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.Party.Types.html#blankParty"><span class="hs-identifier hs-var">blankParty</span></a><span>
</span><a name="line-62"></a><span>          </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Party.Types.html#partyRow"><span class="hs-identifier hs-var">partyRow</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Party.Types.html#partyRow"><span class="hs-identifier hs-var">partyRow</span></a><span> </span><a href="Databrary.Model.Party.Types.html#blankParty"><span class="hs-identifier hs-var">blankParty</span></a><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>            </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Party.Types.html#partySortName"><span class="hs-identifier hs-var">partySortName</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630252249"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-64"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Party.Types.html#partyPreName"><span class="hs-identifier hs-var">partyPreName</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630252250"><span class="hs-identifier hs-var">prename</span></a><span>
</span><a name="line-65"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Party.Types.html#partyAffiliation"><span class="hs-identifier hs-var">partyAffiliation</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630252252"><span class="hs-identifier hs-var">affiliation</span></a><span>
</span><a name="line-66"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-67"></a><span>          </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Party.Types.html#partyAccount"><span class="hs-identifier hs-var">partyAccount</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-1630252254"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-68"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-69"></a><span>        </span><a name="local-1630252254"><a href="#local-1630252254"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Model.Party.Types.html#Account"><span class="hs-identifier hs-var">Account</span></a><span>
</span><a name="line-70"></a><span>          </span><span class="hs-special">{</span><span> </span><a href="Databrary.Model.Party.Types.html#accountParty"><span class="hs-identifier hs-var">accountParty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630252253"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-71"></a><span>          </span><span class="hs-special">,</span><span> </span><a href="Databrary.Model.Party.Types.html#accountEmail"><span class="hs-identifier hs-var">accountEmail</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630252251"><span class="hs-identifier hs-var">email</span></a><span>
</span><a name="line-72"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-1630252254"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-74"></a><span>  </span><a name="local-1630252256"><a href="#local-1630252256"><span class="hs-identifier">auth</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Party.Types.html#SiteAuth"><span class="hs-identifier hs-var">SiteAuth</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Databrary.Model.Party.html#addAccount"><span class="hs-identifier hs-var">addAccount</span></a><span> </span><a href="#local-1630252255"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="Databrary.Ops.html#%3C%2A-"><span class="hs-operator hs-var">&lt;*-</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="Databrary.Ops.html#%3C%2A-"><span class="hs-operator hs-var">&lt;*-</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Databrary.Model.Party.html#lookupSiteAuthByEmail"><span class="hs-identifier hs-var">lookupSiteAuthByEmail</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Party.Types.html#accountEmail"><span class="hs-identifier hs-var">accountEmail</span></a><span> </span><a href="#local-1630252255"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span>  </span><a href="Databrary.Controller.Register.html#resetPasswordMail"><span class="hs-identifier hs-var">resetPasswordMail</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1630252256"><span class="hs-identifier hs-var">auth</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-string">&quot;Databrary account created&quot;</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-1630252257"><a href="#local-1630252257"><span class="hs-identifier">url</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-78"></a><span>      </span><span class="hs-string">&quot;Thank you for registering with Databrary. Please use this link to complete your registration:\n\n&quot;</span><span>
</span><a name="line-79"></a><span>      </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-1630252257"><span class="hs-identifier hs-var">url</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;\n\n\
      \By clicking the above link, you also indicate that you have read and understand the Databrary Access agreement, which you can download here: http://databrary.org/policies/agreement.pdf\n\n\
      \Once you've validated your e-mail, you will be able to request authorization to be granted full access to Databrary.\n&quot;</span><span>
</span><a name="line-82"></a><span>  </span><a href="Databrary.Has.html#focusIO"><span class="hs-identifier hs-var">focusIO</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Static.Fillin.html#staticSendInvestigator"><span class="hs-identifier hs-var">staticSendInvestigator</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Has.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><a href="#local-1630252256"><span class="hs-identifier hs-var">auth</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Response.html#okResponse"><span class="hs-identifier hs-var">okResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Your confirmation email has been sent to '&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="Databrary.Model.Party.Types.html#accountEmail"><span class="hs-identifier hs-var">accountEmail</span></a><span> </span><a href="#local-1630252255"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;'.&quot;</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-identifier">resendInvestigator</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Model.Id.Types.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="Databrary.Model.Party.Types.html#Party"><span class="hs-identifier hs-type">Party</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><a name="resendInvestigator"><a href="Databrary.Controller.Register.html#resendInvestigator"><span class="hs-identifier">resendInvestigator</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">POST</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathHTML"><span class="hs-identifier hs-var">pathHTML</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3E%2F%3E"><span class="hs-operator hs-var">&gt;/&gt;</span></a><span> </span><a href="Databrary.Controller.Paths.html#pathId"><span class="hs-identifier hs-var">pathId</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;investigator&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1630252258"><a href="#local-1630252258"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withAuth"><span class="hs-identifier hs-var">withAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-87"></a><span>  </span><a href="Databrary.Controller.Permission.html#checkMemberADMIN"><span class="hs-identifier hs-var">checkMemberADMIN</span></a><span>
</span><a name="line-88"></a><span>  </span><a name="local-1630252259"><a href="#local-1630252259"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Party.html#getParty"><span class="hs-identifier hs-var">getParty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Databrary.Model.Permission.Types.html#PermissionREAD"><span class="hs-identifier hs-var">PermissionREAD</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Paths.html#TargetParty"><span class="hs-identifier hs-var">TargetParty</span></a><span> </span><a href="#local-1630252258"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>  </span><a href="Databrary.Has.html#focusIO"><span class="hs-identifier hs-var">focusIO</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Static.Fillin.html#staticSendInvestigator"><span class="hs-identifier hs-var">staticSendInvestigator</span></a><span> </span><a href="#local-1630252259"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-90"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Response.html#okResponse"><span class="hs-identifier hs-var">okResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;sent&quot;</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-identifier">viewPasswordReset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><a name="viewPasswordReset"><a href="Databrary.Controller.Register.html#viewPasswordReset"><span class="hs-identifier">viewPasswordReset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">GET</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathHTML"><span class="hs-identifier hs-var">pathHTML</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;user&quot;</span><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;password&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withoutAuth"><span class="hs-identifier hs-var">withoutAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-94"></a><span>  </span><a href="Databrary.Controller.Angular.html#angular"><span class="hs-identifier hs-var">angular</span></a><span>
</span><a name="line-95"></a><span>  </span><a href="Databrary.Has.html#peeks"><span class="hs-identifier hs-var">peeks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Form.html#blankForm"><span class="hs-identifier hs-var">blankForm</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Databrary.View.Register.html#htmlPasswordReset"><span class="hs-identifier hs-var">htmlPasswordReset</span></a><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-identifier">postPasswordReset</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Action.Route.html#ActionRoute"><span class="hs-identifier hs-type">ActionRoute</span></a><span> </span><a href="Databrary.Action.Route.html#API"><span class="hs-identifier hs-type">API</span></a><span>
</span><a name="line-98"></a><a name="postPasswordReset"><a href="Databrary.Controller.Register.html#postPasswordReset"><span class="hs-identifier">postPasswordReset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Action.Route.html#action"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-identifier hs-var">POST</span><span> </span><span class="hs-special">(</span><a href="Databrary.Action.Route.html#pathAPI"><span class="hs-identifier hs-var">pathAPI</span></a><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;user&quot;</span><span> </span><a href="Databrary.HTTP.Path.Parser.html#%3C%2F%3C"><span class="hs-operator hs-var">&lt;/&lt;</span></a><span> </span><span class="hs-string">&quot;password&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-1630252260"><a href="#local-1630252260"><span class="hs-identifier">api</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Action.Run.html#withoutAuth"><span class="hs-identifier hs-var">withoutAuth</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-99"></a><span>  </span><a name="local-1630252261"><a href="#local-1630252261"><span class="hs-identifier">email</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Form.html#runForm"><span class="hs-identifier hs-var">runForm</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630252260"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Databrary.Action.Route.html#HTML"><span class="hs-identifier hs-var">HTML</span></a><span> </span><a href="Databrary.Ops.html#%3F%3E"><span class="hs-operator hs-var">?&gt;</span></a><span> </span><a href="Databrary.View.Register.html#htmlPasswordReset"><span class="hs-identifier hs-var">htmlPasswordReset</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-string">&quot;email&quot;</span><span> </span><a href="Databrary.HTTP.Form.Deform.html#.%3A%3E"><span class="hs-operator hs-var">.:&gt;</span></a><span> </span><a href="Databrary.Controller.Form.html#emailTextForm"><span class="hs-identifier hs-var">emailTextForm</span></a><span>
</span><a name="line-101"></a><span>  </span><a name="local-1630252262"><a href="#local-1630252262"><span class="hs-identifier">auth</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Controller.Token.html#lookupPasswordResetAccount"><span class="hs-identifier hs-var">lookupPasswordResetAccount</span></a><span> </span><a href="#local-1630252261"><span class="hs-identifier hs-var">email</span></a><span>
</span><a name="line-102"></a><span>  </span><a href="Databrary.Controller.Register.html#resetPasswordMail"><span class="hs-identifier hs-var">resetPasswordMail</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-1630252261"><span class="hs-identifier hs-var">email</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-1630252262"><span class="hs-identifier hs-var">auth</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-string">&quot;Databrary password reset&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-special">(</span><span class="hs-string">&quot;Someone (hopefully you) has requested to reset the password for the Databrary account associated with this email address. If you did not request this, let us know (by replying to this message) or simply ignore it.\n\n&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">maybe</span><span>
</span><a name="line-106"></a><span>      </span><span class="hs-string">&quot;Unfortunately, no Databrary account was found for this email address. You can try again with a different email address, or reply to this email for assistance.\n&quot;</span><span>
</span><a name="line-107"></a><span>      </span><span class="hs-special">(</span><span class="hs-string">&quot;Otherwise, you may use this link to reset your Databrary password:\n\n&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Action.Response.html#okResponse"><span class="hs-identifier hs-var">okResponse</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Your password reset information has been sent to '&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-1630252261"><span class="hs-identifier hs-var">email</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;'.&quot;</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a></pre></body></html>