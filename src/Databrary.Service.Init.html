<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings, TemplateHaskell, RecordWildCards #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Init</span><span>
</span><a name="line-3"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Databrary.Service.Init.html#withService"><span class="hs-identifier hs-var">withService</span></a><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bracket</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">when</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">void</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">IORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">newIORef</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">Clock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getCurrentTime</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Ops.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Ops</span></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Databrary.Store.Config.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">Config</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Service.DB.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">DB</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Service.DB.html#initDB"><span class="hs-identifier hs-var">initDB</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Service.DB.html#finiDB"><span class="hs-identifier hs-var">finiDB</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Service.DB.html#runDBM"><span class="hs-identifier hs-var">runDBM</span></a><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Service.Entropy.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Entropy</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Service.Entropy.html#initEntropy"><span class="hs-identifier hs-var">initEntropy</span></a><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.HTTP.Client.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Client</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.HTTP.Client.html#initHTTPClient"><span class="hs-identifier hs-var">initHTTPClient</span></a><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.Service.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Store.Service.html#initStorage"><span class="hs-identifier hs-var">initStorage</span></a><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Store.AV.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Store</span><span class="hs-operator">.</span><span class="hs-identifier">AV</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Store.AV.html#initAV"><span class="hs-identifier hs-var">initAV</span></a><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Service.Passwd.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Passwd</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Service.Passwd.html#initPasswd"><span class="hs-identifier hs-var">initPasswd</span></a><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Service.Log.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Log</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Service.Log.html#initLogs"><span class="hs-identifier hs-var">initLogs</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Log.html#finiLogs"><span class="hs-identifier hs-var">finiLogs</span></a><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Service.Messages.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Messages</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Service.Messages.html#loadMessages"><span class="hs-identifier hs-var">loadMessages</span></a><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Web.Service.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Web</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Web.Service.html#initWeb"><span class="hs-identifier hs-var">initWeb</span></a><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Static.Service.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Static</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Static.Service.html#initStatic"><span class="hs-identifier hs-var">initStatic</span></a><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Ingest.Service.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Ingest</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Ingest.Service.html#initIngest"><span class="hs-identifier hs-var">initIngest</span></a><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Model.Stats.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Model</span><span class="hs-operator">.</span><span class="hs-identifier">Stats</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Solr.Service.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Solr</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Solr.Service.html#initSolr"><span class="hs-identifier hs-var">initSolr</span></a><span class="hs-special">,</span><span> </span><a href="Databrary.Solr.Service.html#finiSolr"><span class="hs-identifier hs-var">finiSolr</span></a><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.EZID.Service.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">EZID</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.EZID.Service.html#initEZID"><span class="hs-identifier hs-var">initEZID</span></a><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Service.Notification.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Notification</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Service.Periodic.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Periodic</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Service.Periodic.html#forkPeriodic"><span class="hs-identifier hs-var">forkPeriodic</span></a><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Service.Types.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Service</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="Databrary.Controller.Notification.html"><span class="hs-identifier">Databrary</span><span class="hs-operator">.</span><span class="hs-identifier">Controller</span><span class="hs-operator">.</span><span class="hs-identifier">Notification</span></a><span> </span><span class="hs-special">(</span><a href="Databrary.Controller.Notification.html#forkNotifier"><span class="hs-identifier hs-var">forkNotifier</span></a><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-identifier">initService</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Store.Config.html#Config"><span class="hs-identifier hs-type">C</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Config</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Databrary.Service.Types.html#Service"><span class="hs-identifier hs-type">Service</span></a><span>
</span><a name="line-33"></a><a name="initService"><a href="Databrary.Service.Init.html#initService"><span class="hs-identifier">initService</span></a></a><span> </span><a name="local-1630658548"><a href="#local-1630658548"><span class="hs-identifier">fg</span></a></a><span> </span><a name="local-1630658549"><a href="#local-1630658549"><span class="hs-identifier">conf</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-34"></a><span>  </span><a name="local-1630658550"><a href="#local-1630658550"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getCurrentTime</span><span>
</span><a name="line-35"></a><span>  </span><a name="local-1630658551"><a href="#local-1630658551"><span class="hs-identifier">logs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Service.Log.html#initLogs"><span class="hs-identifier hs-var">initLogs</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-1630658548"><span class="hs-identifier hs-var">fg</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;log&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;log.bg&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>  </span><a name="local-1630658552"><a href="#local-1630658552"><span class="hs-identifier">entropy</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Service.Entropy.html#initEntropy"><span class="hs-identifier hs-var">initEntropy</span></a><span>
</span><a name="line-37"></a><span>  </span><a name="local-1630658553"><a href="#local-1630658553"><span class="hs-identifier">passwd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Service.Passwd.html#initPasswd"><span class="hs-identifier hs-var">initPasswd</span></a><span>
</span><a name="line-38"></a><span>  </span><a name="local-1630658554"><a href="#local-1630658554"><span class="hs-identifier">messages</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Service.Messages.html#loadMessages"><span class="hs-identifier hs-var">loadMessages</span></a><span>
</span><a name="line-39"></a><span>  </span><a name="local-1630658555"><a href="#local-1630658555"><span class="hs-identifier">db</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Service.DB.html#initDB"><span class="hs-identifier hs-var">initDB</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-string">&quot;db&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span>  </span><a name="local-1630658556"><a href="#local-1630658556"><span class="hs-identifier">storage</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Store.Service.html#initStorage"><span class="hs-identifier hs-var">initStorage</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-string">&quot;store&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>  </span><a name="local-1630658557"><a href="#local-1630658557"><span class="hs-identifier">av</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Store.AV.html#initAV"><span class="hs-identifier hs-var">initAV</span></a><span>
</span><a name="line-42"></a><span>  </span><a name="local-1630658558"><a href="#local-1630658558"><span class="hs-identifier">web</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Web.Service.html#initWeb"><span class="hs-identifier hs-var">initWeb</span></a><span>
</span><a name="line-43"></a><span>  </span><a name="local-1630658559"><a href="#local-1630658559"><span class="hs-identifier">httpc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.HTTP.Client.html#initHTTPClient"><span class="hs-identifier hs-var">initHTTPClient</span></a><span>
</span><a name="line-44"></a><span>  </span><a name="local-1630658560"><a href="#local-1630658560"><span class="hs-identifier">static</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Static.Service.html#initStatic"><span class="hs-identifier hs-var">initStatic</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-string">&quot;static&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>  </span><a name="local-1630658561"><a href="#local-1630658561"><span class="hs-identifier">solr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Solr.Service.html#initSolr"><span class="hs-identifier hs-var">initSolr</span></a><span> </span><a href="#local-1630658548"><span class="hs-identifier hs-var">fg</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-string">&quot;solr&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span>  </span><a name="local-1630658562"><a href="#local-1630658562"><span class="hs-identifier">ezid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.EZID.Service.html#initEZID"><span class="hs-identifier hs-var">initEZID</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-string">&quot;ezid&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>  </span><a name="local-1630658563"><a href="#local-1630658563"><span class="hs-identifier">ingest</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Ingest.Service.html#initIngest"><span class="hs-identifier hs-var">initIngest</span></a><span>
</span><a name="line-48"></a><span>  </span><a name="local-1630658564"><a href="#local-1630658564"><span class="hs-identifier">notify</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Databrary.Service.Notification.html#initNotifications"><span class="hs-identifier hs-var">initNotifications</span></a><span> </span><span class="hs-special">(</span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-string">&quot;notification&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>  </span><a name="local-1630658565"><a href="#local-1630658565"><span class="hs-identifier">stats</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-1630658548"><span class="hs-identifier hs-var">fg</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Databrary.Service.DB.html#runDBM"><span class="hs-identifier hs-var">runDBM</span></a><span> </span><a href="#local-1630658555"><span class="hs-identifier hs-var">db</span></a><span> </span><a href="Databrary.Model.Stats.html#lookupSiteStats"><span class="hs-identifier hs-var">lookupSiteStats</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;siteStats&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>  </span><a name="local-1630658566"><a href="#local-1630658566"><span class="hs-identifier">statsref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><a href="#local-1630658565"><span class="hs-identifier hs-var">stats</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-1630658567"><a href="#local-1630658567"><span class="hs-identifier">rc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Service.Types.html#Service"><span class="hs-identifier hs-var">Service</span></a><span>
</span><a name="line-52"></a><span>        </span><span class="hs-special">{</span><span> </span><a href="Databrary.Service.Types.html#serviceStartTime"><span class="hs-identifier hs-var">serviceStartTime</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658550"><span class="hs-identifier hs-var">time</span></a><span>
</span><a name="line-53"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceSecret"><span class="hs-identifier hs-var">serviceSecret</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Databrary.Service.Types.html#Secret"><span class="hs-identifier hs-var">Secret</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-string">&quot;secret&quot;</span><span>
</span><a name="line-54"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceEntropy"><span class="hs-identifier hs-var">serviceEntropy</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658552"><span class="hs-identifier hs-var">entropy</span></a><span>
</span><a name="line-55"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#servicePasswd"><span class="hs-identifier hs-var">servicePasswd</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658553"><span class="hs-identifier hs-var">passwd</span></a><span>
</span><a name="line-56"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceLogs"><span class="hs-identifier hs-var">serviceLogs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658551"><span class="hs-identifier hs-var">logs</span></a><span>
</span><a name="line-57"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceMessages"><span class="hs-identifier hs-var">serviceMessages</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658554"><span class="hs-identifier hs-var">messages</span></a><span>
</span><a name="line-58"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceDB"><span class="hs-identifier hs-var">serviceDB</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658555"><span class="hs-identifier hs-var">db</span></a><span>
</span><a name="line-59"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceStorage"><span class="hs-identifier hs-var">serviceStorage</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658556"><span class="hs-identifier hs-var">storage</span></a><span>
</span><a name="line-60"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceAV"><span class="hs-identifier hs-var">serviceAV</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658557"><span class="hs-identifier hs-var">av</span></a><span>
</span><a name="line-61"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceWeb"><span class="hs-identifier hs-var">serviceWeb</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658558"><span class="hs-identifier hs-var">web</span></a><span>
</span><a name="line-62"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceHTTPClient"><span class="hs-identifier hs-var">serviceHTTPClient</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658559"><span class="hs-identifier hs-var">httpc</span></a><span>
</span><a name="line-63"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceStatic"><span class="hs-identifier hs-var">serviceStatic</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658560"><span class="hs-identifier hs-var">static</span></a><span>
</span><a name="line-64"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceStats"><span class="hs-identifier hs-var">serviceStats</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658566"><span class="hs-identifier hs-var">statsref</span></a><span>
</span><a name="line-65"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceIngest"><span class="hs-identifier hs-var">serviceIngest</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658563"><span class="hs-identifier hs-var">ingest</span></a><span>
</span><a name="line-66"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceSolr"><span class="hs-identifier hs-var">serviceSolr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658561"><span class="hs-identifier hs-var">solr</span></a><span>
</span><a name="line-67"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceEZID"><span class="hs-identifier hs-var">serviceEZID</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658562"><span class="hs-identifier hs-var">ezid</span></a><span>
</span><a name="line-68"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#servicePeriodic"><span class="hs-identifier hs-var">servicePeriodic</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-69"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceNotification"><span class="hs-identifier hs-var">serviceNotification</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658564"><span class="hs-identifier hs-var">notify</span></a><span>
</span><a name="line-70"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Databrary.Service.Types.html#serviceDown"><span class="hs-identifier hs-var">serviceDown</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658549"><span class="hs-identifier hs-var">conf</span></a><span> </span><a href="Databrary.Store.Config.html#%21"><span class="hs-identifier hs-var">C</span><span class="hs-operator hs-var">.!</span></a><span> </span><span class="hs-string">&quot;store.DOWN&quot;</span><span>
</span><a name="line-71"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-72"></a><span>  </span><a name="local-1630658568"><a href="#local-1630658568"><span class="hs-identifier">periodic</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-1630658548"><span class="hs-identifier hs-var">fg</span></a><span> </span><a href="Databrary.Ops.html#%3F%24%3E"><span class="hs-operator hs-var">?$&gt;</span></a><span> </span><a href="Databrary.Service.Periodic.html#forkPeriodic"><span class="hs-identifier hs-var">forkPeriodic</span></a><span> </span><a href="#local-1630658567"><span class="hs-identifier hs-var">rc</span></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-1630658548"><span class="hs-identifier hs-var">fg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Databrary.Controller.Notification.html#forkNotifier"><span class="hs-identifier hs-var">forkNotifier</span></a><span> </span><a href="#local-1630658567"><span class="hs-identifier hs-var">rc</span></a><span>
</span><a name="line-74"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="#local-1630658567"><span class="hs-identifier hs-var">rc</span></a><span>
</span><a name="line-75"></a><span>    </span><span class="hs-special">{</span><span> </span><a href="Databrary.Service.Types.html#servicePeriodic"><span class="hs-identifier hs-var">servicePeriodic</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-1630658568"><span class="hs-identifier hs-var">periodic</span></a><span>
</span><a name="line-76"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-identifier">finiService</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Databrary.Service.Types.html#Service"><span class="hs-identifier hs-type">Service</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><a name="finiService"><a href="Databrary.Service.Init.html#finiService"><span class="hs-identifier">finiService</span></a></a><span> </span><a href="Databrary.Service.Types.html#Service"><span class="hs-identifier hs-var">Service</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-80"></a><span>  </span><a href="Databrary.Solr.Service.html#finiSolr"><span class="hs-identifier hs-var">finiSolr</span></a><span> </span><a href="#local-1630658583"><span class="hs-identifier hs-var">serviceSolr</span></a><span>
</span><a name="line-81"></a><span>  </span><a href="Databrary.Service.DB.html#finiDB"><span class="hs-identifier hs-var">finiDB</span></a><span> </span><a href="#local-1630658575"><span class="hs-identifier hs-var">serviceDB</span></a><span>
</span><a name="line-82"></a><span>  </span><a href="Databrary.Service.Log.html#finiLogs"><span class="hs-identifier hs-var">finiLogs</span></a><span> </span><a href="#local-1630658573"><span class="hs-identifier hs-var">serviceLogs</span></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-identifier">withService</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Databrary.Store.Config.html#Config"><span class="hs-identifier hs-type">C</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Config</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Databrary.Service.Types.html#Service"><span class="hs-identifier hs-type">Service</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1630658547"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-1630658547"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-85"></a><a name="withService"><a href="Databrary.Service.Init.html#withService"><span class="hs-identifier">withService</span></a></a><span> </span><a name="local-1630658588"><a href="#local-1630658588"><span class="hs-identifier">fg</span></a></a><span> </span><a name="local-1630658589"><a href="#local-1630658589"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">bracket</span><span> </span><span class="hs-special">(</span><a href="Databrary.Service.Init.html#initService"><span class="hs-identifier hs-var">initService</span></a><span> </span><a href="#local-1630658588"><span class="hs-identifier hs-var">fg</span></a><span> </span><a href="#local-1630658589"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="Databrary.Service.Init.html#finiService"><span class="hs-identifier hs-var">finiService</span></a><span>
</span><a name="line-86"></a></pre></body></html>